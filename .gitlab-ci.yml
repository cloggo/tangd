image: registry.delite.ca/docker/docker:latest

variables:
  GIT_SUBMODULE_STRATEGY: recursive
  NODE_MODULE_PATH: node_modules/.bin
  MOCHA_BIN: $NODE_MODULE_PATH/mocha
  NODEGYP_BIN: $NODE_MODULE_PATH/node-gyp
  NODEPREGYP_BIN: $NODE_MODULE_PATH/node-pre-gyp
  DOCKER_RUN: docker run --user root -t -e NODE_ENV=test -v $CI_PROJECT_DIR:/deploy $DEV_IMAGE

stages:

before_script:
  - echo "//npm.delite.ca/:_authToken=\"${NPM_TOKEN}\"" > ~/.npmrc


cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
  - node_modules/
  - build/stage/

